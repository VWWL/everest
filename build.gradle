buildscript {
    ext.kotlin_version = '1.6.21'
    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:1.6.21"
        classpath("org.jetbrains.kotlinx:kover:0.5.0")
    }
}

plugins {
    alias(libs.plugins.springBoot)
    alias(libs.plugins.springDependencyManagement)
    id("org.jetbrains.kotlinx.kover") version "0.5.0"
    id "org.jetbrains.kotlin.jvm" version "1.6.21"
}

apply plugin: "kotlin"

allprojects {
    if (subprojects.size() > 0 && name != rootProject.name) return
    if (name == "documents" || projectDir.parentFile.name == "frontends") return

    group = 'java-ci-scaffold'
    version '1.0.0'

    apply from: "$rootDir/gradle/config/scripts/java.gradle"
    apply from: "$rootDir/gradle/config/scripts/junit.gradle"
    apply from: "$rootDir/gradle/config/scripts/style.gradle"
    apply from: "$rootDir/gradle/config/scripts/coverage.gradle"
    apply from: "$rootDir/style.gradle"
    apply plugin: "kotlin"

    dependencies {
        implementation "org.jetbrains.kotlin:kotlin-stdlib:1.6.21"
        testImplementation "org.jetbrains.kotlin:kotlin-test:1.6.21"
        implementation "org.jetbrains.kotlin:kotlin-reflect:1.6.21"
        compileOnly libs.lombok
        implementation libs.guava
        implementation libs.commonsLang3
        annotationProcessor libs.lombok
        testCompileOnly libs.lombok
        testAnnotationProcessor libs.lombok
    }

    test.dependsOn(checkstyleMain)

    sourceSets {
        main.kotlin.srcDirs += 'src/main/kotlin'
        main.java.srcDirs += 'src/main/java'
    }
}

subprojects {
    apply plugin: 'java-library'
    tasks.named('test') { test ->
        if (!rootProject.hasProperty('chainTests')) return
        rootProject.tasks.named('test') {
            it.dependsOn(test)
        }
    }
}

dependencies {
    implementation project(":domain.core")
    implementation project(":application.core")
    implementation project(":users.gateways")
    testImplementation project(":core.test")
    implementation libs.springBootActuator
    implementation "org.jetbrains.kotlin:kotlin-stdlib:1.6.21"
    implementation "org.jetbrains.kotlin:kotlin-reflect:1.6.21"
    testImplementation "org.jetbrains.kotlin:kotlin-test:1.6.21"
    implementation libs.springBootWeb
    implementation libs.springBootAop
    implementation libs.flyaway
    implementation libs.springdoc
    implementation libs.h2
    annotationProcessor libs.springBootConfigurationProcessor
    testImplementation libs.springBootTest
    testImplementation libs.testcontainersJunitJupiter
    testImplementation libs.moco
}
if (!project.hasProperty('jacocoDisabled')) {
    apply from: "$rootDir/gradle/config/scripts/coverage-all.gradle"
    apply from: "./coverage.gradle"
}
jar {
    enabled = false
}

sourceSets {
    main.kotlin.srcDirs += 'src/main/kotlin'
    main.java.srcDirs += 'src/main/java'
}
